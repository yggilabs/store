---
layout: content
content_class: product
sidebar: true
---
<amp-state id="product">
  <script type="application/json">
    {      
      {%- for attribute in page.attributes -%}
      "selected_{{ attribute.name }}": "{{ attribute.items.first }}", 
      {%- endfor -%}      
      "price": {{ page.price }}
    }    
  </script>
</amp-state>
<div class="product__selectors">
{%- for attribute in page.attributes -%}
<amp-selector name="{{ attribute.name }}"
  layout="container"
  [selected]="product.selected_{{ attribute.name }}"
  on="select:AMP.setState({
    product: {
      selected_{{ attribute.name }}: event.targetOption
    }
   })">
  <ul>
  {%- for item in attribute.items -%}
    <li{% if forloop.first %} selected{% endif %} option="{{ item }}">{{ item }}</li>
  {%- endfor -%}
  </ul>
</amp-selector>
{%- endfor -%}
</div>
<div class="product__image">
  <amp-img
    width="1698"
    height="2911"
    layout="responsive"
    alt="an image"
    src="https://images-na.ssl-images-amazon.com/images/I/81A9r-kog%2BL._UL1500_.jpg"></amp-img>
</div>
<div class="product__submit-button">
  <form method="post"
    action-xhr="https://us-central1-cart-991a0.cloudfunctions.net/api/shop/{{ site.github.repository_nwo | url_encode | replace: "/","%2f" }}/cart/"
    target="_top"
    on="submit-success:cart.refresh">
    <input name="cartId"  
      type="hidden"
      value="CLIENT_ID(cart)"
      data-amp-replace="CLIENT_ID">
    <input name="productId"  
      type="hidden"
      value="{{ page.path }}">
    {%- for attribute in page.attributes -%}
    <input name="attributes[{{ attribute.name }}]"  
      type="hidden"
      value="{{ attribute.items.first }}"
      [value]="product.selected_{{ attribute.name }}">
    {%- endfor -%}
    <input type="submit">
  </form>
</div>
<div class="product__cart-button">
  <button on='tap:sidebar.toggle'>cart</button>
</div>
<amp-sidebar id="sidebar" layout="nodisplay" side="right" on="open:cart.refresh">
  <amp-list id="cart"    
    layout="fill"
    src="https://us-central1-cart-991a0.cloudfunctions.net/api/shop/{{ site.github.repository_nwo | url_encode | replace: "/","%2f" }}/cart/?clientId=CLIENT_ID(cart)">
    {% raw %}
    <template type="amp-mustache">
      <div>{{ id }}</div>
    </template>
    {% endraw %}
  </amp-list>
</amp-sidebar>

